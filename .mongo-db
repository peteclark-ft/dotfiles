#!/bin/bash

function mongo_primary {
  colours
  if [ -z $1 ]; then
    echo "${amber_status} Usage - mongo_primary [up-tunnel-url]"
    cleanup_colours && return 1
  fi

  local mongos="1 2 3"
  for mongo in $mongos; do
    local result=$(ssh $1 'fleetctl ssh mongodb@'${mongo}' docker exec mongodb-'${mongo}' mongo upp-store --eval "db.isMaster\(\).ismaster"' | grep -v "MongoDB shell" | grep -v "connecting to")
    if [ "$result" == "true" ]; then
      echo "${green_status} Connecting to Mongo Primary @ ${1}"
      ssh -t $1 'fleetctl ssh mongodb@'${mongo}' docker exec -ti mongodb-'${mongo}' mongo upp-store'
      cleanup_colours && return 0
    fi
  done

  echo "${red_status} There are no Primary Mongos @ ${1}!"
  cleanup_colours && return 2
}
